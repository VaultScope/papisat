<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:VaultScope.UI.ViewModels"
             x:Class="VaultScope.UI.Views.VulnerabilityDetailsView"
             x:DataType="vm:VulnerabilityDetailsViewModel">

  <Grid RowDefinitions="Auto,*">
    
    <!-- Header -->
    <Border Grid.Row="0" Classes="GlassCard" Margin="24,24,24,0">
      <StackPanel>
        <TextBlock Text="Vulnerability Details" 
                   Classes="HeadingLarge" 
                   Margin="0,0,0,8" />
        <TextBlock Text="Detailed analysis of discovered security vulnerabilities and remediation guidance"
                   Classes="BodyLarge"
                   Foreground="{StaticResource TextSecondaryBrush}" />
      </StackPanel>
    </Border>

    <!-- Main Content -->
    <Grid Grid.Row="1" ColumnDefinitions="*,2*" Margin="24">
      
      <!-- Left Panel - Vulnerabilities List -->
      <Border Grid.Column="0" Classes="GlassCard" Margin="0,0,12,0">
        <StackPanel>
          <Grid ColumnDefinitions="*,Auto" Margin="0,0,0,16">
            <TextBlock Grid.Column="0" Text="All Vulnerabilities" 
                       Classes="HeadingMedium" />
            <Button Grid.Column="1" 
                    Content="Refresh" 
                    Classes="GlassButton" 
                    Command="{Binding RefreshCommand}" />
          </Grid>

          <!-- Summary Cards -->
          <Grid ColumnDefinitions="*,*" Margin="0,0,0,16">
            <StackPanel Grid.Column="0">
              <TextBlock Text="{Binding TotalVulnerabilities}" 
                         Classes="BodyLarge" 
                         HorizontalAlignment="Center" 
                         Foreground="{StaticResource ErrorBrush}" 
                         FontWeight="SemiBold" />
              <TextBlock Text="Total Found" 
                         Classes="CaptionText" 
                         HorizontalAlignment="Center" />
            </StackPanel>
            
            <StackPanel Grid.Column="1">
              <TextBlock Text="{Binding CriticalCount}" 
                         Classes="BodyLarge" 
                         HorizontalAlignment="Center" 
                         Foreground="{StaticResource CriticalBrush}" 
                         FontWeight="SemiBold" />
              <TextBlock Text="Critical" 
                         Classes="CaptionText" 
                         HorizontalAlignment="Center" />
            </StackPanel>
          </Grid>

          <!-- Severity Breakdown -->
          <Border Classes="GlassCard" Margin="0,0,0,16" Padding="12">
            <StackPanel Spacing="4">
              <TextBlock Text="Severity Breakdown" 
                         Classes="BodySmall" 
                         FontWeight="Medium" 
                         Margin="0,0,0,8" />
              
              <Grid ColumnDefinitions="Auto,*,Auto">
                <Ellipse Grid.Column="0" Width="8" Height="8" Fill="{StaticResource CriticalBrush}" VerticalAlignment="Center" />
                <TextBlock Grid.Column="1" Text="Critical" Classes="CaptionText" Margin="8,0,0,0" VerticalAlignment="Center" />
                <TextBlock Grid.Column="2" Text="{Binding CriticalCount}" Classes="CaptionText" FontWeight="Medium" VerticalAlignment="Center" />
              </Grid>
              
              <Grid ColumnDefinitions="Auto,*,Auto">
                <Ellipse Grid.Column="0" Width="8" Height="8" Fill="{StaticResource HighBrush}" VerticalAlignment="Center" />
                <TextBlock Grid.Column="1" Text="High" Classes="CaptionText" Margin="8,0,0,0" VerticalAlignment="Center" />
                <TextBlock Grid.Column="2" Text="{Binding HighCount}" Classes="CaptionText" FontWeight="Medium" VerticalAlignment="Center" />
              </Grid>
              
              <Grid ColumnDefinitions="Auto,*,Auto">
                <Ellipse Grid.Column="0" Width="8" Height="8" Fill="{StaticResource MediumBrush}" VerticalAlignment="Center" />
                <TextBlock Grid.Column="1" Text="Medium" Classes="CaptionText" Margin="8,0,0,0" VerticalAlignment="Center" />
                <TextBlock Grid.Column="2" Text="{Binding MediumCount}" Classes="CaptionText" FontWeight="Medium" VerticalAlignment="Center" />
              </Grid>
              
              <Grid ColumnDefinitions="Auto,*,Auto">
                <Ellipse Grid.Column="0" Width="8" Height="8" Fill="{StaticResource LowBrush}" VerticalAlignment="Center" />
                <TextBlock Grid.Column="1" Text="Low" Classes="CaptionText" Margin="8,0,0,0" VerticalAlignment="Center" />
                <TextBlock Grid.Column="2" Text="{Binding LowCount}" Classes="CaptionText" FontWeight="Medium" VerticalAlignment="Center" />
              </Grid>
            </StackPanel>
          </Border>

          <!-- Filters -->
          <StackPanel Spacing="8" Margin="0,0,0,16">
            <TextBox Text="{Binding SearchText}" 
                     Classes="GlassTextBox" 
                     Watermark="Search vulnerabilities..." />
            
            <ComboBox SelectedItem="{Binding SelectedSeverityFilter}" 
                      Classes="GlassTextBox">
              <ComboBoxItem Content="All Severities" />
              <ComboBoxItem Content="Critical" />
              <ComboBoxItem Content="High" />
              <ComboBoxItem Content="Medium" />
              <ComboBoxItem Content="Low" />
            </ComboBox>

            <ComboBox SelectedItem="{Binding SelectedTypeFilter}" 
                      Classes="GlassTextBox">
              <ComboBoxItem Content="All Types" />
              <ComboBoxItem Content="SQL Injection" />
              <ComboBoxItem Content="XSS" />
              <ComboBoxItem Content="Authentication" />
              <ComboBoxItem Content="Authorization" />
            </ComboBox>
          </StackPanel>

          <!-- Loading State -->
          <Border Classes="LoadingIndicator" 
                  IsVisible="{Binding IsLoading}">
            <StackPanel Spacing="8">
              <ProgressBar IsIndeterminate="True" Width="150" Height="4" />
              <TextBlock Text="Loading vulnerabilities..." 
                         Classes="BodySmall" 
                         HorizontalAlignment="Center" />
            </StackPanel>
          </Border>

          <!-- No Vulnerabilities Message -->
          <StackPanel Classes="EmptyState" 
                      IsVisible="{Binding !FilteredVulnerabilities.Count}">
            <Path Data="M12,2C13.1,2 14,2.9 14,4C14,5.1 13.1,6 12,6C10.9,6 10,5.1 10,4C10,2.9 10.9,2 12,2M21,9V7L15,1H5C3.89,1 3,1.89 3,3V21A2,2 0 0,0 5,23H19A2,2 0 0,0 21,21V9M19,9H14V4H5V21H19V9Z" 
                  Classes="IconLarge" 
                  Fill="{StaticResource SuccessBrush}" />
            <TextBlock Text="No vulnerabilities found" 
                       Classes="HeadingSmall" 
                       Foreground="{StaticResource SuccessBrush}" />
            <TextBlock Text="This means your applications are secure!" 
                       Classes="BodyMedium" 
                       Foreground="{StaticResource TextTertiaryBrush}" />
          </StackPanel>

          <!-- Vulnerabilities List -->
          <ListBox ItemsSource="{Binding FilteredVulnerabilities}" 
                   SelectedItem="{Binding SelectedVulnerability}"
                   Background="Transparent" 
                   BorderThickness="0"
                   ScrollViewer.VerticalScrollBarVisibility="Auto"
                   IsVisible="{Binding FilteredVulnerabilities.Count}">
            <ListBox.ItemTemplate>
              <DataTemplate>
                <Border Classes="GlassCard" 
                        Margin="0,0,0,8" 
                        Padding="12">
                  <StackPanel>
                    <Grid ColumnDefinitions="*,Auto" Margin="0,0,0,4">
                      <TextBlock Grid.Column="0" 
                                 Text="{Binding Title}" 
                                 Classes="BodyMedium" 
                                 FontWeight="Medium" />
                      <Border Grid.Column="1" 
                              Classes="CriticalBadge">
                        <TextBlock Text="{Binding Severity}" 
                                   Classes="CaptionText" 
                                   Foreground="White" />
                      </Border>
                    </Grid>

                    <TextBlock Text="{Binding AffectedEndpoint}" 
                               Classes="BodySmall" 
                               Foreground="{StaticResource TextTertiaryBrush}" 
                               Margin="0,0,0,4" />

                    <Grid ColumnDefinitions="*,Auto">
                      <TextBlock Grid.Column="0" 
                                 Text="{Binding Type}" 
                                 Classes="CaptionText" 
                                 Foreground="{StaticResource InfoBrush}" />
                      <TextBlock Grid.Column="1" 
                                 Text="{Binding ConfidenceScore, StringFormat='{}{0:P0}'}" 
                                 Classes="CaptionText" 
                                 Foreground="{StaticResource SuccessBrush}" />
                    </Grid>
                  </StackPanel>
                </Border>
              </DataTemplate>
            </ListBox.ItemTemplate>
          </ListBox>
          
        </StackPanel>
      </Border>

      <!-- Right Panel - Vulnerability Details -->
      <Border Grid.Column="1" Classes="GlassCard" Margin="12,0,0,0">
        <ScrollViewer>
          <StackPanel>
            
            <!-- No Selection Message -->
            <StackPanel Classes="EmptyState" 
                        IsVisible="{Binding !SelectedVulnerability}">
              <Path Data="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M7,13H17V11H7" 
                    Classes="IconLarge" 
                    Fill="{StaticResource TextMutedBrush}" />
              <TextBlock Text="Select a vulnerability" 
                         Classes="HeadingSmall" 
                         Foreground="{StaticResource TextMutedBrush}" />
              <TextBlock Text="Choose a vulnerability from the list to view detailed information" 
                         Classes="BodyMedium" 
                         Foreground="{StaticResource TextTertiaryBrush}" />
            </StackPanel>

            <!-- Vulnerability Details -->
            <StackPanel IsVisible="{Binding SelectedVulnerability}">
              
              <!-- Header -->
              <Grid ColumnDefinitions="*,Auto" Margin="0,0,0,16">
                <StackPanel Grid.Column="0">
                  <TextBlock Text="{Binding SelectedVulnerability.Title}" 
                             Classes="HeadingMedium" />
                  <TextBlock Text="{Binding SelectedVulnerability.Type}" 
                             Classes="BodyMedium" 
                             Foreground="{StaticResource TextSecondaryBrush}" />
                </StackPanel>
                
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                  <Border Classes="CriticalBadge">
                    <TextBlock Text="{Binding SelectedVulnerability.Severity}" 
                               Classes="BodySmall" 
                               Foreground="White" />
                  </Border>
                  <Button Content="Export" 
                          Classes="GlassButton" 
                          Command="{Binding ExportVulnerabilityCommand}" 
                          CommandParameter="{Binding SelectedVulnerability}" />
                </StackPanel>
              </Grid>

              <!-- Summary Info -->
              <Border Classes="GlassCard" Margin="0,0,0,16">
                <Grid ColumnDefinitions="*,*,*">
                  <StackPanel Grid.Column="0">
                    <TextBlock Text="{Binding SelectedVulnerability.ConfidenceScore, StringFormat='{}{0:P0}'}" 
                               Classes="HeadingSmall" 
                               HorizontalAlignment="Center" 
                               Foreground="{StaticResource SuccessBrush}" />
                    <TextBlock Text="Confidence" 
                               Classes="BodySmall" 
                               HorizontalAlignment="Center" />
                  </StackPanel>
                  
                  <StackPanel Grid.Column="1">
                    <TextBlock Text="{Binding SelectedVulnerability.HttpMethod}" 
                               Classes="HeadingSmall" 
                               HorizontalAlignment="Center" 
                               Foreground="{StaticResource InfoBrush}" />
                    <TextBlock Text="HTTP Method" 
                               Classes="BodySmall" 
                               HorizontalAlignment="Center" />
                  </StackPanel>
                  
                  <StackPanel Grid.Column="2">
                    <TextBlock Text="{Binding SelectedVulnerability.DiscoveredAt, StringFormat='{}{0:MM/dd/yy}'}" 
                               Classes="HeadingSmall" 
                               HorizontalAlignment="Center" 
                               Foreground="{StaticResource TextSecondaryBrush}" />
                    <TextBlock Text="Discovered" 
                               Classes="BodySmall" 
                               HorizontalAlignment="Center" />
                  </StackPanel>
                </Grid>
              </Border>

              <!-- Description -->
              <Border Classes="GlassCard" Margin="0,0,0,16">
                <StackPanel>
                  <TextBlock Text="Description" 
                             Classes="HeadingSmall" 
                             Margin="0,0,0,8" />
                  <TextBlock Text="{Binding SelectedVulnerability.Description}" 
                             Classes="BodyMedium" 
                             TextWrapping="Wrap" />
                </StackPanel>
              </Border>

              <!-- Affected Endpoint -->
              <Border Classes="GlassCard" Margin="0,0,0,16">
                <StackPanel>
                  <TextBlock Text="Affected Endpoint" 
                             Classes="HeadingSmall" 
                             Margin="0,0,0,8" />
                  <Border Background="{StaticResource SurfaceBrush}" 
                          CornerRadius="4" 
                          Padding="8">
                    <TextBlock Text="{Binding SelectedVulnerability.AffectedEndpoint}" 
                               Classes="MonospaceText" />
                  </Border>
                </StackPanel>
              </Border>

              <!-- Evidence -->
              <Border Classes="GlassCard" 
                      Margin="0,0,0,16"
                      IsVisible="{Binding SelectedVulnerability.Evidence}">
                <StackPanel>
                  <TextBlock Text="Evidence" 
                             Classes="HeadingSmall" 
                             Margin="0,0,0,8" />
                  <ScrollViewer MaxHeight="200" 
                                VerticalScrollBarVisibility="Auto"
                                HorizontalScrollBarVisibility="Disabled">
                    <Border Background="{StaticResource SurfaceBrush}" 
                            Padding="8" 
                            CornerRadius="4">
                      <TextBlock Text="{Binding SelectedVulnerability.Evidence}" 
                                 Classes="MonospaceText" 
                                 TextWrapping="Wrap" />
                    </Border>
                  </ScrollViewer>
                </StackPanel>
              </Border>

              <!-- Payload Used -->
              <Border Classes="GlassCard" 
                      Margin="0,0,0,16"
                      IsVisible="{Binding SelectedVulnerability.PayloadUsed}">
                <StackPanel>
                  <TextBlock Text="Payload Used" 
                             Classes="HeadingSmall" 
                             Margin="0,0,0,8" />
                  <Border Background="{StaticResource SurfaceBrush}" 
                          Padding="8" 
                          CornerRadius="4">
                    <TextBlock Text="{Binding SelectedVulnerability.PayloadUsed}" 
                               Classes="MonospaceText" 
                               TextWrapping="Wrap" />
                  </Border>
                </StackPanel>
              </Border>

              <!-- Remediation -->
              <Border Classes="GlassCard" 
                      Margin="0,0,0,16"
                      IsVisible="{Binding SelectedVulnerability.Remediation}">
                <StackPanel>
                  <TextBlock Text="Remediation" 
                             Classes="HeadingSmall" 
                             Margin="0,0,0,8" />
                  <TextBlock Text="{Binding SelectedVulnerability.Remediation}" 
                             Classes="BodyMedium" 
                             TextWrapping="Wrap" />
                </StackPanel>
              </Border>

              <!-- OWASP & CWE Information -->
              <Grid ColumnDefinitions="*,*">
                <Border Grid.Column="0" Classes="GlassCard"
                        IsVisible="{Binding SelectedVulnerability.OwaspCategory}">
                  <StackPanel>
                    <TextBlock Text="OWASP Category" 
                               Classes="HeadingSmall" 
                               Margin="0,0,0,8" />
                    <TextBlock Text="{Binding SelectedVulnerability.OwaspCategory}" 
                               Classes="BodyMedium" 
                               FontWeight="Medium" />
                  </StackPanel>
                </Border>

                <Border Grid.Column="1" Classes="GlassCard"
                        IsVisible="{Binding SelectedVulnerability.CweId}">
                  <StackPanel>
                    <TextBlock Text="CWE ID" 
                               Classes="HeadingSmall" 
                               Margin="0,0,0,8" />
                    <TextBlock Text="{Binding SelectedVulnerability.CweId}" 
                               Classes="BodyMedium" 
                               FontWeight="Medium" />
                  </StackPanel>
                </Border>
              </Grid>
              
            </StackPanel>
            
          </StackPanel>
        </ScrollViewer>
      </Border>

    </Grid>
  </Grid>

</UserControl>